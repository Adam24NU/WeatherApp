<?xml version="1.0" encoding="utf-8" ?>
<TabbedPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
            x:Class="WeatherApp.Pages.OpsManagerPage"
            xmlns:local="clr-namespace:WeatherApp.Pages"
            xmlns:converters="clr-namespace:WeatherApp.Converters">

    <TabbedPage.Resources>
        <ResourceDictionary>
            <converters:BoolToColorConverter x:Key="BoolToColorConverter" />
            <converters:StatusToTextConverter x:Key="StatusToTextConverter" />
            <converters:StatusToColorConverter x:Key="StatusToColorConverter" />
            <converters:StatusToEnableConverter x:Key="StatusToEnableConverter" />
        </ResourceDictionary>
    </TabbedPage.Resources>

    <!-- Sensors Overview Tab -->
    <ContentPage Title="Sensors">
        <CollectionView x:Name="DataList"
                        ItemsSource="{Binding DisplayedData}"
                        Margin="10"
                        ItemsLayout="VerticalList">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame BorderColor="LightGray"
                           CornerRadius="10"
                           Padding="10"
                           Margin="5"
                           BackgroundColor="{Binding IsThresholdBreached, Converter={StaticResource BoolToColorConverter}}">

                        <StackLayout>
                            <Label Text="{Binding SensorType, StringFormat='📡 Sensor: {0}'}" />
                            <Label Text="{Binding SensorId, StringFormat='🧰 Sensor ID: {0}'}" FontAttributes="Bold" FontSize="16"/>
                            <Label Text="{Binding MeasurementFrequency, StringFormat='🔁 Measurement: {0}'}" />
                            <Label Text="{Binding SafeLevel, StringFormat='📏 Safe Level: {0}'}" />
                            <Label Text="{Binding Status, StringFormat='⚠️ Status: {0}'}" FontAttributes="Italic" />

                            <!-- Report Issue Button -->
                            <Button Text="📣 Report Issue"
                                    Clicked="OnReportIssueClicked"
                                    CommandParameter="{Binding}" />
                        </StackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </ContentPage>

    <!-- Verify Data Tab -->
    <ContentPage Title="Verify Data">
        <ScrollView>
            <StackLayout Padding="10">
                <Label Text="✅ Data Verification Report"
                       FontAttributes="Bold"
                       FontSize="20"
                       HorizontalOptions="Center" />

                <CollectionView ItemsSource="{Binding DisplayedData}"
                                Margin="10"
                                ItemsLayout="VerticalList">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BorderColor="CornflowerBlue"
                                   CornerRadius="10"
                                   Padding="10"
                                   Margin="5">
                                <StackLayout Spacing="8">
                                    <!-- Sensor Info -->
                                    <Label Text="{Binding SensorId, StringFormat='Sensor ID: {0}'}"
                                           FontAttributes="Bold"/>
                                    <Label Text="{Binding LastReading, StringFormat='Latest Reading: {0:F2}'}"/>
                                    <Label Text="{Binding Timestamp, StringFormat='Timestamp: {0:dd MMM yyyy HH:mm}'}"/>

                                    <!-- Verification Buttons -->
                                    <StackLayout Orientation="Horizontal" Spacing="10">
                                        <Button Text="{Binding Status, Converter={StaticResource StatusToTextConverter}}"
                                                BackgroundColor="{Binding Status, Converter={StaticResource StatusToColorConverter}}"
                                                Clicked="OnVerifyClicked"
                                                CommandParameter="{Binding}"
                                                IsEnabled="{Binding Status, Converter={StaticResource StatusToEnableConverter}}" />


                                    </StackLayout>
                                </StackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </StackLayout>
        </ScrollView>
    </ContentPage>


    <!-- Maintenance Overview Tab -->
    <ContentPage Title="Maintenance">
        <CollectionView x:Name="MaintenanceList"
                        ItemsSource="{Binding MaintenanceTasks}"
                        Margin="10"
                        ItemsLayout="VerticalList">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame BorderColor="LightGray"
                           CornerRadius="10"
                           Padding="10"
                           Margin="5">

                        <StackLayout>
                            <Label Text="{Binding SensorType, StringFormat='📡 Sensor: {0}'}" />
                            <Label Text="{Binding SensorId, StringFormat='🧰 Sensor ID: {0}'}" FontAttributes="Bold" FontSize="16"/>
                            <Label Text="{Binding MeasurementFrequency, StringFormat='🔁 Measurement: {0}'}" />
                            <Label Text="{Binding SafeLevel, StringFormat='📏 Safe Level: {0}'}" />
                            <Label Text="{Binding Status, StringFormat='⚠️ Status: {0}'}" FontAttributes="Italic" />
                            <Label Text="{Binding MaintainerEmail, StringFormat='🔧 Maintainer: {0}'}" />
                            <Label Text="{Binding MaintenanceDate, StringFormat='🛠 Scheduled: {0:dd MMM yyyy}'}" />
                        </StackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </ContentPage>
</TabbedPage>
