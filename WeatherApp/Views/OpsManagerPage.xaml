<ContentPage
    x:Class="WeatherApp.Views.OpsManagerPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Sensor Status">

    <StackLayout Padding="10">
        <Label
            Margin="0,10"
            FontSize="24"
            HorizontalOptions="Center"
            Text="Sensor Maintenance Overview" />

        <CollectionView
            x:Name="SensorList"
            HeightRequest="500"
            ItemsSource="{Binding DisplayedData}"
            RemainingItemsThreshold="2"
            RemainingItemsThresholdReached="CollectionView_RemainingItemsThresholdReached">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame
                        Margin="5"
                        Padding="10"
                        BorderColor="LightGray"
                        CornerRadius="10">
                        <StackLayout>
                            <Label
                                FontAttributes="Bold"
                                FontSize="16"
                                Text="{Binding SensorID}" />
                            <Label Text="{Binding Type}" />
                            <Label Text="{Binding Location}" />
                            <Label Text="{Binding Installed, StringFormat='Installed: {0:dd MMM yyyy}'}" />
                            <Label FontAttributes="Italic" Text="{Binding Status}" />

                            <!--  ⚠ If flagged  -->
                            <Label
                                FontAttributes="Bold"
                                IsVisible="{Binding IsFlagged}"
                                Text="⚠ Issue Reported"
                                TextColor="Red" />

                            <!--  🛠 Report button  -->
                            <Button
                                Clicked="OnReportIssueClicked"
                                CommandParameter="{Binding}"
                                Text="Report Issue" />
                        </StackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </StackLayout>
</ContentPage>
